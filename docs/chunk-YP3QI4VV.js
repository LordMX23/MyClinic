import{a as b,b as U}from"./chunk-6RUBYT2X.js";import{F as p,Y as g,aa as k,ga as w,hc as f,ib as d,q as c,r as m,u as l}from"./chunk-NOTB5GDI.js";var S={authBaseUrl:"https://localhost:7005"};var a=function(e){return e.checking="checking",e.authenticated="authenticated",e.notAuthenticated="notAuthenticated",e}(a||{});var i=class extends Error{};i.prototype.name="InvalidTokenError";function I(e){return decodeURIComponent(atob(e).replace(/(.)/g,(t,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function y(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return I(t)}catch{return atob(t)}}function v(e,t){if(typeof e!="string")throw new i("Invalid token specified: must be a string");t||(t={});let n=t.header===!0?0:1,r=e.split(".")[n];if(typeof r!="string")throw new i(`Invalid token specified: missing part #${n+1}`);let o;try{o=y(r)}catch(s){throw new i(`Invalid token specified: invalid base64 for part #${n+1} (${s.message})`)}try{return JSON.parse(o)}catch(s){throw new i(`Invalid token specified: invalid json for part #${n+1} (${s.message})`)}}var z=(()=>{let t=class t{constructor(){this.authBaseUrl=S.authBaseUrl,this.http=w(U),this._currentUser=d(null),this._authStatus=d(a.checking);this.currentUser=f(()=>this._currentUser()),this.authStatus=f(()=>this._authStatus()),this.checkAuthStatus().subscribe()}login(r,o){let s=`${this.authBaseUrl}/user/Login`,u={email:r,password:o};return this.http.post(s,u).pipe(g(h=>{this.setAuthentication(h.accessToken)}),l(()=>!0),p(h=>m(()=>h.error.title)))}checkAuthStatus(){let r=`${this.authBaseUrl}/user/CheckToken`,o=localStorage.getItem("token");if(!o)return this.logout(),c(!1);let s=new b().set("Authorization",`Bearer ${o}`);return this.http.post(r,"",{headers:s}).pipe(l(()=>{let u=localStorage.getItem("token");return this.setAuthentication(u),!0}),p(()=>(this._authStatus.set(a.notAuthenticated),console.log("Token invalido"),c(!1))))}logout(){localStorage.removeItem("token"),this._currentUser.set(null),this._authStatus.set(a.notAuthenticated)}setAuthentication(r){let o=v(r);return this._currentUser.set(o),this._authStatus.set(a.authenticated),localStorage.setItem("token",r),this._authStatus.set(a.authenticated),!0}};t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=k({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();export{a,z as b};
